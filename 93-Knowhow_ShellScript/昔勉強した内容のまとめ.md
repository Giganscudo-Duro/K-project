
# 参考URL
https://gigazine.net/news/20200826-docker-hub-update-policy/
- [bashのプロンプトを変更するには - @it](https://www.atmarkit.co.jp/flinux/rensai/linuxtips/002cngprmpt.html)
- []()
- [bashのヒアドキュメントを活用する - Qiita](https://qiita.com/take4s5i/items/e207cee4fb04385a9952)
- [シェルでpingの成功ステータスを確認する方法 - IT技術の処方箋](http://www.searchman.info/tips/1660.html)
- [ShellScript【 while read 】ファイルを１行ずつ読み込む - Qiita](https://qiita.com/r18j21/items/70018b98509309a0d2c5)
- [Bash・Shellでループ処理で1行ずつテキストファイルを読み込む方法](https://shimi-dai.com/while-read-line/)
- [【シェルスクリプト】ファイルの中身を一行ずつ読み込む方法 ](https://www.server-memo.net/shellscript/read-file.html)
- [シェルスクリプトのWhile文で代入した変数が空になっている時の対処 - 俺的備忘録](https://orebibou.com/ja/home/201411/20141115_001/)
- [bashのSECONDS変数で簡単に処理時間を測定する- Qiita](https://qiita.com/mikeda/items/c6bb68dd1e4ba6434fb7)
- [timeコマンドでプログラムの実行時間を知る - Qiita](https://qiita.com/tossh/items/659e5934e52b38183200)
- [Linuxでコマンドや処理の実行時間を調べる方法 - server-memo.net](https://www.server-memo.net/tips/runtime_research.html)
- [timeコマンドの実行結果をリダイレクトする](https://spidy-spidy.hatenadiary.org/entry/20071228/1198774974)
- [コマンド time コマンド・プログラムの実行時間を計測する](http://x68000.q-e-d.net/~68user/unix/pickup?time#prgmemo-time-output)
- []()
- []()
- []()
- []()
- []()
- []()




# シェルスクリプトをデバッグモードで実行する
```sh
$ sh -x test.sh test.txt
```

# シェルスクリプト実行にかかった時間を計測する
bashで特定の処理にかかった秒数を測定するには、dateコマンドで前後の秒数をとって引き算するのが一般的です。

- `date` コマンドの実行結果の差分から計測する
    ```sh
    #!/bin/bash
    
    START_TIME=`date +%s`
    
    sleep 10
    
    END_TIME=`date +%s`
    
    run_time=$((end_time - start_time))
    echo $run_time
    ```

別の方法としては、bashの特殊変数の1つである `SECONDS` を使う方法がある。  
この変数を参照するとbashが起動されてからの秒数が取得でき、任意のタイミングで代入によってリセットすることができる。
- `SECONDS` を用いた場合
    ```sh
    #!/bin/bash
    
    SECONDS=0
    
    ### 時間測定したい処理
    sleep 3
    
    time=$SECONDS
    echo $time
    ```


















```sh





#!/bin/bash

##############################################################################################
# 設定した回数分、同じイメージをpullし続け、その実行にかかった時間の平均を出力する
PULL_IMAGE="ubuntu"
PULL_IMAGE_TAG="latest"
DPR_URI="localhost:5000"
NEW_IMAGE_NAME="kana"
NEW_IMAGE_TAG="tag"
MAX_COUNT=10
TIMEFILE="time.txt"


SECONDS=0
TIMEFORMAT='dockerhub = %R'
# (time docker pull ${PULL_IMAGE}:${PULL_IMAGE_TAG} -q > /dev/null) 2>${TIMEFILE}
(time docker pull ${PULL_IMAGE}:${PULL_IMAGE_TAG} -q > /dev/null) 2>dockerhub.txt

docker tag ${PULL_IMAGE}:${PULL_IMAGE_TAG} ${DPR_URI}/${NEW_IMAGE_NAME}:${NEW_IMAGE_TAG}-0
docker push ${DPR_URI}/${NEW_IMAGE_NAME}:${NEW_IMAGE_TAG}-0

docker rmi ${DPR_URI}/${NEW_IMAGE_NAME}:${NEW_IMAGE_TAG}-0
docker rmi ${PULL_IMAGE}:${PULL_IMAGE_TAG}


COUNT=1
while [ ${COUNT} -lt $((${MAX_COUNT} + 1)) ]
do
    echo "try - ${COUNT}"
    TIMEFORMAT='%R'
    (time docker pull ${DPR_URI}/${NEW_IMAGE_NAME}:${NEW_IMAGE_TAG}-0 -q) 2>>${TIMEFILE}
    # (time docker pull ${DPR_URI}/${NEW_IMAGE_NAME}:${NEW_IMAGE_TAG}-0 -q > /dev/null) 2>>${TIMEFILE}
    docker rmi ${DPR_URI}/${NEW_IMAGE_NAME}:${NEW_IMAGE_TAG}-0
    COUNT=$((${COUNT} + 1))
done

echo "---------------------------------"
SUM=0
COUNT=0
while read line
do
    SUM=`echo "scale=4; ${SUM} + ${line}" | bc`
        COUNT=$((${COUNT} + 1))
    echo "${COUNT} try = ${line} s"
done < ${TIMEFILE}
AVERAGE=`echo "scale=4; ${SUM} / ${COUNT}" | bc`
cat dockerhub.txt
echo "average = ${AVERAGE} s"
TIME=${SECONDS}
echo "execute all time = ${TIME} s"

rm -rf ${TIMEFILE}

exit 0




##############################################################################################
# 規定した日数分、同じイメージをpullし続ける
PULL_IMAGE="hello-world"
PULL_IMAGE_TAG="latest"
DPR_URI="localhost:5000"
NEW_IMAGE_NAME="kana"
NEW_IMAGE_TAG="tag"
SCEDULE_DAYS=2

docker pull ${PULL_IMAGE}:${PULL_IMAGE_TAG}
docker tag ${PULL_IMAGE}:${PULL_IMAGE_TAG} ${DPR_URI}/${NEW_IMAGE_NAME}:${NEW_IMAGE_TAG}-0
docker push ${DPR_URI}/${NEW_IMAGE_NAME}:${NEW_IMAGE_TAG}-0

docker rmi ${DPR_URI}/${NEW_IMAGE_NAME}:${NEW_IMAGE_TAG}-0
docker rmi ${PULL_IMAGE}:${PULL_IMAGE_TAG}

MAX_SECONDS=10
SECONDS=0

while [ ${SECONDS} -lt $((${MAX_SECONDS})) ]
do
    echo "try - ${SECONDS}"
    docker pull ${DPR_URI}/${NEW_IMAGE_NAME}:${NEW_IMAGE_TAG}-0
    docker rmi ${DPR_URI}/${NEW_IMAGE_NAME}:${NEW_IMAGE_TAG}-0
done

TIME=${SECONDS}
echo "---------------------------------"
echo ${TIME}



```
